产品目标：打造一款面向个人/家庭的多账户记账工具，支持快速录入、账目统计、预算提醒和跨设备同步，提升用户对资金流的掌控感。

- 核心用户：1) 日常记账的普通个人；2) 管理家庭账务的家庭成员；3) 有多账户/多货币需求的小微经营者。
- 关键价值：快速录入（低摩擦流程）、可视化统计（趋势/分类）、预算与提醒（行为干预）、多终端数据一致性。

功能需求

- 账户管理：支持现金、银行卡、信用卡、电子钱包及自定义账户；账户余额展示与调账；账户间转账。
- 记账录入：支出/收入/转账三种类型；标签、分类、商户、成员、项目等扩展字段；拍照/语音/模板记账；批量导入历史账单。
- 分类体系：预置分类+自定义；分类层级（一级/二级）；分类预算与可视化。
- 预算管理：按月/周/自定义周期设置预算；可按总额或分类分配；超支提醒、预警推送；预算执行情况仪表盘。
- 统计分析：时间维度（日报、周报、月报、年报）、分类维度（支出/收入）、账户维度（资金占比、盈亏）、成员维度（家庭账分配）；趋势图、饼图、柱状图；可导出报表。
- 搜索与筛选：按时间、金额区间、分类、标签、成员、商户等组合查询；保存常用筛选。
- 同步与备份：本地存储+云同步（Firebase/自建后端）；自动备份、手动导出（CSV/Excel）；历史版本回溯。
- 多设备支持：手机端（iOS/Android），后续可扩展到小程序/桌面端；离线可用、恢复时自动同步。
- 通知与提醒：记账提醒（可自定义频率/时间段）、账单到期提醒（信用卡、贷款）、预算预警。
- 安全与隐私：本地加密存储、云端传输加密；可设置指纹/Face ID/手势锁；隐私模式（隐藏金额）。
- 增值功能（可选）：家庭共享账本（成员权限控制）、AI 智能分类（OCR/语义识别）、自动导入银行/支付宝/微信流水、资产负债全景视图、理财收益统计。

用户旅程

- 初次使用：注册/免注册（本地模式）；引导设置主要账户、首月预算、基础分类；提供示例数据帮助理解。
- 每日记账：打开即见快捷录入入口，支持模板/最近记录复用；语音或拍照识别减少输入成本。
- 周/月复盘：自动生成报表推送，突出消费热点、预算执行、异常支出；可一键分享或导出。
- 异常提醒：预算超支、信用卡还款、连续多日未记账等，通过系统通知或邮件触达。
- 家庭协作（可选）：账本共享邀请、成员分角色记账、公共支出AA结算、评论或备注。

数据与模型

- 核心实体：用户、账本、账户、交易（含明细字段）、分类、预算、标签、成员。
- 交易字段建议：类型、金额、币种、汇率、账户、对方账户、分类、标签、成员、商户、项目、备注、附件、时间、创建人、更新时间、同步状态。
- 预算实体：周期、范围（总/分类/标签）、提醒阈值、执行状态。
- 审计与历史：交易修改记录（旧值、新值、时间、操作者），便于回滚与协作审计。

非功能需求

- 性能：本地操作 <100ms 响应，统计生成 <2s；本地缓存常用数据，分页加载历史。
- 可用性：离线可用、弱网缓冲；错误提示友好；提供新手教程、FAQ。
- 可扩展性：模块化状态管理，支持后续接入更多账户类型或第三方 API。
- 可靠性：重要操作（删除、批量导入）需确认与回滚；自动备份策略（每日增量、每周全量）。
- 安全：遵循本地法规的数据保护要求；对敏感信息加密存储；日志脱敏。
- 易维护：明确模块边界（录入、账户、统计、同步等），单元测试覆盖关键逻辑（金额计算、汇率换算、预算判定）。

技术架构建议

- 客户端：Flutter（推荐使用 Riverpod/Bloc 进行状态管理，Freezed 编写数据模型）；适配 Material 3；国际化。
- 本地存储：Hive/Drift（原 Moor）管理结构化数据；配置数据缓存策略。
- 同步方案：阶段一可使用 Firebase Firestore + Cloud Functions；或自建 NestJS/Spring Boot 后端 + PostgreSQL/MongoDB；使用 GraphQL/REST API。
- 通知：Firebase Cloud Messaging/自建推送；结合平台原生日历/提醒。
- 自动化：CI/CD（GitHub Actions/Bitrise）；单元/集成测试、Golden Test；静态分析（flutter analyze、dart test）。
- 安全：使用 flutter_secure_storage 存储令牌；敏感配置通过环境变量或后台下发。

多方案对比

- 同步方式
  1. 纯本地离线：实现简单、无需后端；缺点是无法跨设备。
  2. Firebase：快速上线、运维压力低；缺点是成本随用户增长、部分地区访问不稳定。
  3. 自建后端：可控性高、可定制权限和自动导入；缺点是初期开发/运维成本高。
     推荐：初版采用 Firebase，后续用户规模扩大或有合规需求再迁移自建。
- 状态管理
  1. Provider：上手简单、样例多；缺点是复杂场景容易出现状态散乱。
  2. Bloc/Cubit：结构化强、可预测；缺点是模板代码较多。
  3. Riverpod：灵活、编译期安全；缺点是学习成本略高。
     推荐：选择 Riverpod，兼顾灵活与可维护性。
- 图表库
  1. fl_chart：开源、功能丰富；
  2. Syncfusion：商业许可证、控件全面；
  3. charts_flutter：Google 官方，但近年维护较少。
     推荐：初期用 fl_chart（文档丰富），若需要进阶可评估 Syncfusion。

待确认问题

- 是否需要家庭共享或团队协作？影响权限模型与同步设计。
- 是否计划支持多币种？若是，需要汇率管理与金额折算。
- 是否有自动导入（银行/第三方）需求？涉及外部 API、合规与安全。
- 是否考虑订阅/增值服务？影响功能拆分与付费策略。
- 数据合规要求（地区、隐私政策）？会影响存储/同步方案。
- UI 风格偏向（极简/卡通/商务）与是否需要品牌定制？
- 是否需要离线 OCR/语音识别，还是可接受云端识别带来的延迟与隐私问题？
- 首批目标平台仅移动端吗，还是需要同步规划 Web/桌面？

下一步建议

1. 基于上述需求确认 MVP 范围和优先级（建议分阶段：基础记账 → 预算统计 → 同步协作）。
2. 绘制用户流程图和原型草图，验证录入/统计关键体验。
3. 选定技术栈细节（状态管理、存储、同步）并搭建最小可运行骨架（账户+记账+本地存储）。
4. 制定数据结构与 API 契约，为后续同步和扩展打下基础。
5. 安排测试策略（单元、集成、Golden Test）与质量指标。
